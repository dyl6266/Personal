<?xml version="1.0" encoding="UTF-8"?>
<beans:beans
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:beans="http://www.springframework.org/schema/beans"
    xmlns:security="http://www.springframework.org/schema/security"
    xsi:schemaLocation="http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-4.2.xsd
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <!-- auto-config true 설정한것만으로, 기본 로그인 페이지 / HTTP 기본 인증/ 로그아웃 기능들을 제공 -->
    <!-- use-expression true는 SpEL을 사용한다는 의미 -->
    <security:http auto-config="true" use-expressions="true">
        <security:intercept-url pattern="/login.do" access="permitAll" />
        <security:intercept-url pattern="/resources/**" access="permitAll" />
        <!-- ROLE_USER 권한을 가진 사람만 허용 -->
        <security:intercept-url pattern="/**" access="hasRole('ROLE_USER')" />

        <!-- page : 로그인 페이지 URI -->
        <!-- default-target-url : 로그인 성공 시 리다이렉트 페이지 -->
        <!-- authentication-failure-url : 로그인 실패 시 호출할 URI -->
        <!-- always-use-default-target : 해당 설정이 없으면 로그인에 성공해도 리다이렉트되지 않음(?) -->
        <security:form-login
            login-page="/login.do"
            login-processing-url="/auth.do"
            authentication-success-handler-ref="loginSuccessHandler"
            username-parameter="username"
            password-parameter="password"
            authentication-failure-url="/login.do?error"
        />

        <!-- 로그아웃 시 세션 초기화 -->
        <security:logout invalidate-session="true" logout-url="/logout.do" logout-success-url="/login.do?logout" />

        <!-- csrf 보호 기능 활성화 -->
        <security:csrf />
    </security:http>

    <!-- 인증 처리를 위한 최상위 태그 -->
    <security:authentication-manager>
        <!-- username, password를 제공해줄 서비스 등록 -->
        <security:authentication-provider user-service-ref="userService" />
    </security:authentication-manager>

	<beans:bean id="loginSuccessHandler" class="com.dy.common.security.LoginSuccessHandler">
		<beans:property name="defaultTargetUrl" value="/board/list.do" />
		<beans:property name="alwaysUseDefaultTargetUrl" value="true" />
	</beans:bean>

    <beans:bean id="userService" class="com.dy.service.UserService" />

</beans:beans>
